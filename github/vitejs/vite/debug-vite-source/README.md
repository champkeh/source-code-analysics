# æ‰‹æŠŠæ‰‹æ•™ä½ è°ƒè¯• vite æºç 

> åœ¨å­¦ä¹ å¼€æºé¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœèƒ½ä½¿ç”¨è°ƒè¯•å™¨ä¸€æ­¥ä¸€æ­¥åœ°åˆ†æä»£ç çš„æ‰§è¡Œæµç¨‹ï¼Œé‚£å°†ä¼šå¯¹åˆ†æè¿‡ç¨‹æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚

ç”±äº vite é¡¹ç›®æ˜¯é‡‡ç”¨ typescript ç¼–å†™çš„ï¼Œæ‰€ä»¥æƒ³è¦è°ƒæˆå®ƒï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªèƒ½å¤Ÿç›´æ¥æ‰§è¡Œ ts çš„è¿è¡Œç¯å¢ƒã€‚æ­£å¥½ç¤¾åŒºæœ‰ä¸€ä¸ª [ts-node](https://typestrong.org/ts-node/)
é¡¹ç›®å¯ä»¥è®©æˆ‘ä»¬ç”¨`node`ç›´æ¥æ‰§è¡Œ ts ä»£ç ã€‚

å…³äºè¿™ä¸ªé¡¹ç›®çš„æ›´å¤šä»‹ç»å¯ä»¥æŸ¥çœ‹[å®˜ç½‘](https://typestrong.org/ts-node/), è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä»‹ç»å¦‚ä½•é…ç½®ç¼–è¾‘å™¨æ¥è°ƒè¯• vite æºç ã€‚

## å®‰è£…ä¾èµ–

ç”±äºæˆ‘ä»¬éœ€è¦ç”¨åˆ°`ts-node`ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£…å®ƒã€‚æ‰€å¹¸çš„æ˜¯ï¼Œvite é¡¹ç›®çš„å¼€å‘ä¾èµ–é‡Œé¢å·²ç»æœ‰`ts-node`è¿™ä¸ªä¾èµ–äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸éœ€è¦è‡ªå·±è£…äº†ï¼ŒæŠŠ vite é¡¹ç›® clone ä¸‹æ¥ä¹‹åæŠŠä¾èµ–å®‰è£…ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚

> å¦‚æœåç»­ vite æ²¡æœ‰äº†è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ‰‹åŠ¨å®‰è£…ï¼š
>
> ```shell
> npm install -D ts-node
> ```

## webstorm è®¾ç½®

é€šè¿‡èœå• "Run > Edit Configuration..." æ‰“å¼€ "Run/Debug Configurations" å¯¹è¯æ¡†ï¼š

![run/debug configuratins dialog](assets/run-debug-configurations-dialog.png)

æ·»åŠ ä¸€ä¸ª Node.js é…ç½®ï¼Œå¦‚ä¸‹ï¼š

![debug vite configuration](assets/debug-vite-configuration.png)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNode parameters å‚æ•°é…ç½®ä¸º`-r ts-node/register/transpile-only`ï¼Œè¡¨ç¤ºæˆ‘ä»¬è¦ç»™ node é¢„åŠ è½½ä¸€ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…çš„æ•ˆæœå°±æ˜¯ç»™ node åŸç”Ÿçš„`require`
å‡½æ•°æ³¨å…¥ä»£ç ï¼Œä»¥è¾¾åˆ°å¯¹å¼•å…¥çš„ ts ä»£ç å®ç° JIT ç¼–è¯‘ã€‚å…·ä½“åŸç†å¯ä»¥çœ‹[å®˜æ–¹ä»‹ç»](https://typestrong.org/ts-node/docs/how-it-works) ã€‚

ç„¶åå°±æ˜¯ JavaScript file é…ç½®ï¼Œè¿™é‡Œæˆ‘åªæƒ³è°ƒè¯• vite å‘½ä»¤è¡Œï¼Œæ‰€ä»¥æˆ‘é…ç½®æˆ`packages/vite/src/node/cli.ts`ï¼Œä¹Ÿå°±æ˜¯ vite å‘½ä»¤è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚

å¤§åŠŸå‘Šæˆï¼Œç‚¹å‡»è°ƒè¯•æŒ‰é’®å¼€å§‹è°ƒè¯•å§ï¼

å¦‚æœä½ ä¸å¹¸é‡åˆ°äº†ä¸‹é¢è¿™ä¸ªé”™è¯¯ï¼š

![debugger console error](assets/debugger-console-error.png)

æ˜¯å› ä¸º vite æºç ä¸­æœ‰å¼•ç”¨äº†æ„å»ºä¹‹åçš„æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬è¿˜æ²¡æœ‰å¯¹é¡¹ç›®è¿›è¡Œä¸€ä¸ªæ„å»ºï¼Œæ‰€ä»¥å¯¹åº”çš„æ–‡ä»¶è¿˜ä¸å­˜åœ¨ï¼Œå¯åŠ¨ä¸èµ·æ¥ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ° Process Console é¢æ¿çœ‹ä¸€ä¸‹è¿›ç¨‹è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯ï¼š

![process console error](assets/process-console-error.png)

å¯ä»¥çœ‹åˆ°ï¼Œ`constants.ts`æ–‡ä»¶ä¸­æœ‰å¼•ç”¨`vite/dist/client/client.mjs`æ–‡ä»¶ï¼Œä½†æ˜¯å´æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ã€‚ ç¿»çœ‹ä¸€ä¸‹`constants.ts`æºç ï¼Œä¹Ÿå¯ä»¥å‘ç°è¯¥æ–‡ä»¶æœ‰ä¸‹é¢è¿™ä¸¤ä¸ªå¼•ç”¨ï¼š

![constants code](assets/constants-code.png)

æ—¢ç„¶çŸ¥é“äº†åŸå› ï¼Œé‚£æˆ‘ä»¬å°±å…ˆå°†é¡¹ç›®`build`ä¸€ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
pnpm run build
```

å®Œäº†ä¹‹åå†è¿›è¡Œè°ƒè¯•å°±å¯ä»¥äº†ã€‚æ”¾ä¸€å¼ è°ƒè¯•ç•Œé¢æˆªå›¾ï¼š

![debug snapshot](assets/debug-snapshot.png)

## vscode è®¾ç½®

ç”±äºå¯¹ vscode ä¸ç†Ÿï¼Œæ²¡æœ‰é…ç½®æˆåŠŸ ğŸ˜¢

## å‚è€ƒ

- [ts-node](https://typestrong.org/ts-node/)
